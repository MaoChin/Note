# `Redis`集群

提高总的`redis`服务的存储容量。

广义的集群：只要有多台机器构成了分布式系统，就可以认为是一个集群，在这个概念中，主从结构和哨兵机制都可以看成一个集群。

`redis`的集群：`redis`提供的集群模式，主要是为了解决存储空间不足的问题。



## 1. 基本概念

`redis`哨兵只是提高了可用性，但是**所有的数据**还是要存储在主节点和从节点中(内存中！！)，当数据量非常大时，会导致存储空间不足的问题。(内存毕竟是有限的)

==集群就是引入多组 `Master/Slave`，每一组存储所有数据的一部分即可。==每一组`Master/Slave`叫做一个分片(`Sharding`)。

**每一组`Master/Slave`中的所有机器存储的数据是相同的，不同的`Master/Slave`之间存储的数据不同！！**

## 2. 数据分片算法

就是如何把一大份数据分成若干小份？？

### 1. 哈希求余

针对给定的`key`，先进行哈希算法(如MD5)得到`hash`值，再进行 ==模 N 求余==。(N 是分片个数)

```shell 
hash(key) % N
```

优点：简单高效， 数据分配较为均匀。

缺点：当进行扩容时，就是 N 改变时，数据分片的结果大不相同，这就需要在多个`Master/Slave`之间进行数据传输，以适应新的分片。网络开销很大！！

**MD5：使用很广泛的哈希算法，主要有三大优点：**

1. 结果定长。
2. 结果分散，就是原字符串只要有一点不同，结果也会有很大不同。
3. 不可逆，基本不可能从结果恢复出原字符串。

### 2. 一致性哈希算法



### 3. 哈希槽











