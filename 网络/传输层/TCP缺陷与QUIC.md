# `TCP`缺陷与`QUIC`

`TCP`的四个缺陷：

1. 升级 `TCP` 的工作很困难；
2. `TCP` 建立连接的延迟；
3. `TCP` 存在队头阻塞问题；
4. 网络迁移需要重新建立 `TCP` 连接；

基于`UDP`的可靠传输：`QUIC`，并且解决了上述`TCP`的缺陷。

## 1. `Packet Number`

`Short Packet Header` 中的 `Packet Number` 是每个报文独一无二的编号，它是**严格递增**的，也就是说就算 `Packet N` 丢失了，重传的 `Packet N` 的 `Packet Number` 已经不是 `N`，而是一个比 `N` 大的值。

![image-20240312171131908](D:\MyNote\网络\传输层\TCP缺陷与QUIC.assets\image-20240312171131908.png)

`TCP` 在重传报文时的序列号和原始报文的序列号是一样的，也正是由于这个特性，引入了 `TCP` 重传的歧义问题：

当 `TCP` 发生超时重传后，客户端发起重传，然后接收到了服务端确认 `ACK` 。由于客户端原始报文和重传报文序列号都是一样的，那么服务端针对这两个报文回复的都是相同的 `ACK`。这样的话，客户端就无法判断出是「原始报文的响应」还是「重传报文的响应」，这样在计算 `RTT`（往返时间） 时应该选择从发送原始报文开始计算，还是重传原始报文开始计算呢？

然而，如果 `ACK` 的 `Packet Number` 是 `N+M`，就根据重传报文计算采样 `RTT`。如果 `ACK` 的 `Pakcet Number` 是 `N`，就根据原始报文的时间计算采样 `RTT`，没有歧义性的问题。

