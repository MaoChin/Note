# `MySQL`架构

## 1. 总体架构

`MySQL`服务器是由连接池、服务管理工具和公共组件、`NoSQL`接口、`SQL`接口、解析器、优化器、缓存、存储引擎、文件系统组成。`MySQL`还为各种编程语言提供了一套用于外部程序访问服务器的连接器。

![image-20240628101151409](E:\Note\MySQL\MySQL进阶\MySQL架构.assets\image-20240628101151409.png)  

## 2. 连接层

连接层的作用是处理客户端的连接，比如权限校验，线程池的维护，最大连接数的管理等。

## 3. 服务层

数据库服务层是整个数据库服 务器的核心，主要包括了服务管理和公共组件、`NoSQL`和`SQL`接口、解析器、查询优化器和缓存等部分。  

`SQL`语句执行过程：

![image-20240628112305015](E:\Note\MySQL\MySQL进阶\MySQL架构.assets\image-20240628112305015.png)

## 4. 存储引擎

存储引擎是处理不同表类型`SQL`操作的`MySQL`组件。`MySQL`服务器采用可插拔的存储引擎架构，在服务器运行时可以动态的加载和卸载。

#### `InnoDB`的优势（==面试==）

1. DML操作遵循ACID模型，**事务**具有提交、回滚和崩溃恢复功能，以保护用户数据。
2. 如果发生意外而崩溃，无论当时数据库发生了什么，都不需要在重启数据库后执行任何特殊操作。**自动崩溃恢复**
3. 支持**行级锁**，提搞了多用户的读取并发性和性能。  
4. `InnoDB` 存储引擎维护了一个自己的**缓冲池**，访问数据时在内存中缓存表和索引数据，对于经常使用的数据直接从内存中处理，大幅提升了效率。
5. `InnoDB`表优化了基于主键的查询，每个`InnoDB`表都有一个称为**聚簇索引**的主键索引，实现通过最少的磁盘I/O完成对主键的查找。  
6. 为了保持数据完整性， `InnoDB` 支持 `FOREIGN KEY` (外键)约束。    
7. 当从表中反复查询相同的行时，**自适应哈希索引**会自动接管这些查询，此时查询效率和哈希表相同。

#### `MyISAM`的优势（==面试==）

使用`MyISAM`存储引擎的表**占用空间很小**，但是由于使用表级锁定，所以限制了读/写操作的性能，通常用于中小型的`Web`应用和数据仓库配置中的**只读或主要是读的场景**。  

通过 `CREATE table` 创建表时，指定 `DATA DIRECTORY=PATH` 和 `INDEX
DIRECTORY=PATH` 将数据文件和索引文件放在不同设备的不同目录中，从而提高访问速度。（`.MYD`，`.MYI`）简单来说就是**数据和属性分类**，类似`inode`。

#### `MyISAM` 和 `InnoDB` 的主要区别（==面试==）

围绕 **性能与安全** 回答！！

1. `MyISAM`不支持事务
2. `MyISAM`不支持外键
3. 锁粒度不同，`MyISAM`是表锁，而`InnoDB`是行锁
4. `MyISAM`不支持`hash`索引，而`InnoDB`有自适应哈希索引
5. `InnoDB`自己维护了缓冲池









  