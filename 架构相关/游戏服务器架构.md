# 游戏服务器架构

### 1. 架构演进

1. 应用数据分离：引入`MySQL`并增加数据库代理进程(`DB`)

2. 增加缓存`redis`

3. ==逻辑进程拆分(逻辑服务器拆分)==：降低耦合，分摊压力，保证数据一致性(如组队`Team`服务器)

4. 但是逻辑进程拆分后每个玩家客户端需要和所有的逻辑进程交互！！！---》引入==`gateway`进程==

   网关服务的作用：进行信息转发，负载均衡，发送心跳包确定客户端是否掉线，账号管理。

   ![image-20240201144208176](D:\MyNote\架构相关\游戏服务器架构.assets\image-20240201144208176.png)

5. 但是这样扩展性很差！每个逻辑服务器都要和`gateway`连接，逻辑服务器非常多时连接数量非常多。---》引入==全局服务管理器(`Master`)==，全局服务管理器(Master)需要与每个逻辑服务器进行连接，用心跳包维护服务器是否处在可用状态，所以**服务器之间的消息转发由它来承担**，全局服务管
   理器(Master)扮演着==消息队列==的角色。

![image-20240201144810394](D:\MyNote\架构相关\游戏服务器架构.assets\image-20240201144810394.png)

6. 这个`Master`服务器有单点问题  ---》分布式消息队列(分布式`Master`)。消息队列的订阅/发布(`sub/pub`)模式，就是所有的逻辑进程(包括`gateway`)向消息队列订阅自己想要的消息，同时向消息队列发布自己的消息(解耦)。

![image-20240201145051616](D:\MyNote\架构相关\游戏服务器架构.assets\image-20240201145051616.png)

7. 分布式`Master`使得`Master`专心处理消息订阅及发布，那 管理其他服务器的功能就没了 ---》引入==服务发现==。服务发现本质上是一类数据库，存储并管理所有的服务器信息(IP地址，容量，服务器ID，服务器类型等)，比如：当有新的服务器加入时，服务发现会将新的服务器信息广播给所有的服务器，并把其他所有服务器的信息告诉这个新的服务器。

   服务发现：工业级软件实现是`zookeeper`和`etcd`。

### 2. 负载均衡

只要是涉及了服务器的变更和选择，一般都可以进行负载均衡分流。比如登陆和网关都可以设置负载均衡。

### 3. 实时性要求很高的服务

对于实时性要求很高的服务，比如战斗相关的服务，客户端经过`gateway`转发到`battle`服务器可能会比较慢，这是就可以让客户端之间连接`battle`服务器。

![image-20240201151546693](D:\MyNote\架构相关\游戏服务器架构.assets\image-20240201151546693.png)

### 4. 虚拟化技术

虚拟机---在物理层面上进行隔离，然后在硬件上安装完整的`OS`，比较笨重。

`docker`---直接运行在宿主操作系统上，并不需要在额外安装操作系统。

### 5. 云游戏

云游戏跟传统游戏运行的最大差别是游戏是否用本地设备的`GPU`渲染游戏画面。















