# Spring AOP

AOP是Spring框架的第二大核心（第一大核心是IoC）。

AOP：Aspect Oriented Programming（面向切面编程），切面就是指某一类特定问题吗，所以AOP也可以理解为面向特定方法编程。比如拦截器，统一异常处理等都是AOP的应用。

简单来说，==AOP是一种思想，是对某一类事情的集中处理==。  AOP可以在程序运行期间在不修改源代码的基础上对已有方法进行**增强**（无侵入性：解耦）。  

## 1. AOP 核心概念

### 1. 切入点（Pointcut）

告诉程序对哪些方法来进行功能增强。  

### 2. 连接点（JoinPoint）

满足切点表达式规则的方法，就是连接点，也就是可以被AOP控制的具体的某一个方法。    

  ### 3. 通知（Advice）

具体要做的工作，指哪些重复的逻辑，也就是共性功能（最终体现为一个方法）。

### 4. 切面（Aspect）

切面(Aspect) = 切点(Pointcut) + 通知(Advice)      

## 2. 通知类型

1. @Around：环绕通知，此注解标注的通知方法在目标方法前，后都被执行。
2. @Before：前置通知，此注解标注的通知方法在目标方法前被执行。
3. @After：后置通知，此注解标注的通知方法在目标方法后被执行，无论是否有异常都会执行。
4. @AfterReturning：返回后通知，此注解标注的通知方法在目标方法后被执行，有异常不会执行。
5. @AfterThrowing：异常后通知，此注解标注的通知方法发生异常后执行。  

#### @Printcut && @Order

@Printcut 可以统一定义切入点，给多个类的方法使用，而@Order指定这多个类的作用顺序。

#### 切点表达式

主要有两种方式：

1. execution(......)：根据方法的签名来匹配
2. @annotation(.......)：根据注解匹配    

```java
execution(<访问修饰符> <返回类型> <包名.类名.⽅法(⽅法参数)> <异常>)
```

根据注解匹配的方式更加灵活，主要有三个步骤：

1. 编写自定义注解  
2. 使用 @annotation 表达式来描述切点  
3. 在连接点的方法上添加自定义注解  

## 3. SpringAOP原理  

SpringAOP是基于==动态代理==来实现的。

#### 代理模式

代理模式分为 **静态代理 和 动态代理**。

静态代理：代码写死，编译时生成

动态代理：运行时生成

目前动态代理的实现有两种：一是JDK实现；二是CGLIB实现。其中二者最大的区别就是JDK只能代理接口（interface ），不能代理类（class）；而CGLIB可以代理类。

`Spring`实现动态代理 两者都用到了！默认是使用CGLIB代理，可以通过配置文件更改。



