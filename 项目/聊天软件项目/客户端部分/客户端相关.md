# 客户端相关

1. 工厂模式（`MessageInfo`类的构造非常适合，因为`Message`有多种类型）
2. 日志相关
3. 各种界面：个人详细信息界面，好友详细信息界面，单聊详情界面，群聊详情界面，搜索历史消息界面，搜索添加好友界面，登录注册界面....
4. 引入 `ProtoBuf`
5. 



在客户端界面搭建完成后，后续的开发需要服务端的功能支持，这时服务端并没有完成，这时需要 `MockServer` ，通过构建模拟的服务端，构建一些假的数据，完成客户端功能的测试！！

### 客户端服务端交互

#### 1. 客户端和服务器之间的通信协议：

1. `HTTP`，==一问一答==形式
2. `Websocket`，`HTTP`是一问一答形式的，服务器无法主动给客户端发消息！！而实际上用户A给用户B发消息是：A->服务器->B的。而==`Websocket` 协议就可以做到服务器主动给客户端发消息。==

#### 2. 通信协议约定

1. 客户端所有的 `HTTP` 请求都使用 `POST`形 式，不用 `GET`。
2. 客户端服务器之间使用 `HTTP` 协议时数据都存放在`body`（正文）中，不使用`Query String`等其他形式。
3. `HTTP`协议数据通信（ `body` 部分）和`Websocket` 数据通信都统一使用 `protobuf` 进行序列化/反序列化。（效率更高）

#### 3. 网关

在服务端使用的是分布式微服务架构，但是对于客户端来说并不关心服务端内部的架构，只需要直接和网关服务器通信即可！

#### 4. 关于Session

项目中涉及到两套`Session`，一个是客户端登录的`Session`，另一个是用户和用户聊天的`Session`。

登录的`Session`就是常规的 `Cookie-Session`机制：由于`HTTP`协议本身是”无状态“的，即==每一次`HTTP`交互之间相互独立==；但是在业务上希望有状态，即希望一个客户端的后续交互不再需要身份验证了，而是可以直接进行交互，这时就需要一套机制维护登录状态：`Cookie-Session`机制。

`Cookie-Session`机制：服务端存储用户身份信息，并生成唯一的 `SessionID` 返回给客户端，这个  `SessionID` 就存储在客户端的 `Cookie` 中。

#### 5. `Websocket`

`Websocket`代码的几个重要信号（客户端和服务器一样！）

1. `connected` ：建立连接
2. `disconnected` ：断开连接
3. `errorOccurred` ：出错
4. `textMessageReceived` ：收到文本消息
5. `binaryMessageReceived` ：收到二进制消息







